<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.reserve.app.mapper.UserMapper">
	
	<select id="getUserInfo" parameterType="map" resultType="map">
		SELECT id, name, phone_number, due_date, hospital, to_char(created_dt,'YYYY-MM-DD') as created_dt, to_char(modified_dt,'YYYY-MM-DD') as modified_dt, branch_code
		FROM tb_user
		WHERE id like #{login_id}
		ORDER BY created_dt desc, id asc
	</select>
	
	<update id="updateUserInfo" parameterType="map">
		UPDATE	tb_user
		SET name = #{name},
			phone_number = #{phone_number},
			due_date = #{due_date},
			hospital = #{hospital},
			modified_id = #{login_id}, 
			modified_dt = now()
		WHERE id = #{id}
	</update>
	
	<select id="checkOrgPwd" parameterType="map" resultType="int">
		SELECT count(password)
		FROM tb_user
		WHERE id = #{login_id} and password = #{encOrgPassword}
	</select>
	
	<update id="updateUserPwd" parameterType="map">
		UPDATE tb_user
		SET password = #{encNewPassword},
			modified_id = #{login_id}, 
			modified_dt = now()
		WHERE id = #{login_id}
	</update>
	
	<select id="getReservation" parameterType="map" resultType="map">
		SELECT date, time, staff_num
		FROM tb_reservation
		WHERE id like #{login_id}
	</select>
	
</mapper>
